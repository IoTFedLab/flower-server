#!/bin/bash

# π”’ μ—°ν•©ν•™μµ μ„λ²„ λ°©ν™”λ²½ μ„¤μ • μ¤ν¬λ¦½νΈ
# νΉμ • ν΄λΌμ΄μ–ΈνΈ IPλ§ 9092 ν¬νΈ μ ‘κ·Ό ν—μ©

# ν΄λΌμ΄μ–ΈνΈ IP μ£Όμ†
CLIENT1_IP="192.168.35.160"  # μ‹μ°
CLIENT2_IP="223.194.160.130"  # λ―Όμ§€
# CLIENT3_IP="192.168.1.30"  μ†μ—°
# β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”

echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "π”’ μ—°ν•©ν•™μµ μ„λ²„ λ°©ν™”λ²½ μ„¤μ •"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

echo "μ„¤μ •λ ν΄λΌμ΄μ–ΈνΈ IP:"
echo "  1. $CLIENT1_IP"
echo "  2. $CLIENT2_IP"
# echo "  3. $CLIENT3_IP"
echo ""

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "λ°©ν™”λ²½ μ„¤μ • μ‹μ‘..."
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

# UFW μ„¤μΉ ν™•μΈ
echo "1οΈβƒ£ UFW μ„¤μΉ ν™•μΈ μ¤‘..."
if ! command -v ufw &> /dev/null; then
    echo "   UFWκ°€ μ„¤μΉλμ§€ μ•μ•μµλ‹λ‹¤. μ„¤μΉ μ¤‘..."
    sudo apt update
    sudo apt install -y ufw
    echo "   β… UFW μ„¤μΉ μ™„λ£"
else
    echo "   β… UFW μ΄λ―Έ μ„¤μΉλ¨"
fi

echo ""
echo "2οΈβƒ£ κΈ°μ΅΄ 9092 ν¬νΈ κ·μΉ™ μ‚­μ  μ¤‘..."
# 9092 ν¬νΈ κ΄€λ ¨ κ·μΉ™μ΄ μλ”μ§€ ν™•μΈ
if sudo ufw status numbered | grep -q "9092"; then
    echo "   μ‚­μ ν•  κ·μΉ™:"
    sudo ufw status numbered | grep "9092"
    echo ""
    # μ—­μμΌλ΅ μ‚­μ  (λ²νΈκ°€ λ°”λ€μ§€ μ•λ„λ΅)
    for num in $(sudo ufw status numbered | grep "9092" | awk '{print $1}' | sed 's/\[//;s/\]//' | sort -rn); do
        echo "   κ·μΉ™ [$num] μ‚­μ  μ¤‘..."
        echo "y" | sudo ufw delete $num
    done
    echo "   β… κΈ°μ΅΄ 9092 κ·μΉ™ μ‚­μ  μ™„λ£"
else
    echo "   β„ΉοΈ  μ‚­μ ν•  9092 κ·μΉ™ μ—†μ"
fi

echo ""
echo "3οΈβƒ£ SSH ν¬νΈ ν—μ© μ¤‘ (μ¤‘μ”!)..."
sudo ufw allow 22/tcp
echo "   β… SSH (22/tcp) ν—μ©λ¨"

echo ""
echo "4οΈβƒ£ ν΄λΌμ΄μ–ΈνΈ IPλ§ 9092 ν¬νΈ μ ‘κ·Ό ν—μ© μ¤‘..."

# ν΄λΌμ΄μ–ΈνΈ 1 ν—μ©
sudo ufw allow from $CLIENT1_IP to any port 9092 proto tcp
echo "   β… ν΄λΌμ΄μ–ΈνΈ 1 ($CLIENT1_IP) ν—μ©"

# ν΄λΌμ΄μ–ΈνΈ 2 ν—μ©
sudo ufw allow from $CLIENT2_IP to any port 9092 proto tcp
echo "   β… ν΄λΌμ΄μ–ΈνΈ 2 ($CLIENT2_IP) ν—μ©"

# ν΄λΌμ΄μ–ΈνΈ 3 ν—μ©
# sudo ufw allow from $CLIENT3_IP to any port 9092 proto tcp
# echo "   β… ν΄λΌμ΄μ–ΈνΈ 3 ($CLIENT3_IP) ν—μ©"

echo ""
echo "5οΈβƒ£ λ°©ν™”λ²½ ν™μ„±ν™” μ¤‘..."
sudo ufw --force enable
echo "   β… λ°©ν™”λ²½ ν™μ„±ν™” μ™„λ£"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "μµμΆ… λ°©ν™”λ²½ κ·μΉ™:"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
sudo ufw status numbered
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"

echo ""
echo "β… λ°©ν™”λ²½ μ„¤μ • μ™„λ£!"
echo ""
echo "π”’ λ³΄μ• μƒνƒ:"
echo "   - 9092 ν¬νΈλ” μ¤μ§ 2λ€ ν΄λΌμ΄μ–ΈνΈλ§ μ ‘κ·Ό κ°€λ¥"
echo "   - λ‹¤λ¥Έ λ¨λ“  IPλ” 9092 ν¬νΈ μ ‘κ·Ό μ°¨λ‹¨"
echo "   - SSH (22) ν¬νΈλ” λ¨λ“  IPμ—μ„ μ ‘κ·Ό κ°€λ¥"
echo ""
echo "π” ν…μ¤νΈ λ°©λ²•:"
echo "   ν΄λΌμ΄μ–ΈνΈμ—μ„: telnet 203.230.103.35 9092"
echo "   λ‹¤λ¥Έ λ””λ°”μ΄μ¤μ—μ„: telnet 203.230.103.35 9092 (μ°¨λ‹¨λμ–΄μ•Ό ν•¨)"
echo ""
echo "β οΈ  μ£Όμμ‚¬ν•­:"
echo "   - ν΄λΌμ΄μ–ΈνΈ IPκ°€ λ³€κ²½λλ©΄ μ΄ μ¤ν¬λ¦½νΈλ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•μ„Έμ”"
echo "   - κ·μΉ™ μ‚­μ : sudo ufw delete <κ·μΉ™λ²νΈ>"
echo "   - λ°©ν™”λ²½ μƒνƒ ν™•μΈ: sudo ufw status"
echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"

